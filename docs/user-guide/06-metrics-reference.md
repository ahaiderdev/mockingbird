# Metrics Reference

Complete reference for all metrics generated by the Synthetic Metrics Generator.

## Metric Naming

### User-Defined Metrics

Metrics you configure in your YAML file are exported with prefixes:

```
{prefix}{metric_name}
```

**Example**:
```yaml
exporters:
  prometheus:
    prefix: "synthetic_prom_"
  otel:
    prefix: "synthetic_otel_"

metrics:
  - name: requests_total
```

**Exported as**:
- Prometheus: `synthetic_prom_requests_total`
- OTEL: `synthetic_otel_requests_total`

### Generator Self-Monitoring Metrics

Built-in metrics use the `gen_` prefix after your configured prefix:

```
{prefix}gen_{metric_name}
```

**Example**:
- Prometheus: `synthetic_prom_gen_points_total`
- OTEL: `synthetic_otel_gen_points_total`

## User-Defined Metrics

These are the metrics **you configure** in your YAML file.

### Counter Example

```yaml
- name: requests_total
  type: counter
```

**Prometheus**:
```
# HELP synthetic_prom_requests_total Generated counter metric: requests_total
# TYPE synthetic_prom_requests_total counter
synthetic_prom_requests_total{region="us-east-1",instance="i-01",endpoint="/"} 1234
```

**OTEL**: Exported as Sum (monotonic)

### Gauge Example

```yaml
- name: cpu_usage
  type: gauge
```

**Prometheus**:
```
# HELP synthetic_prom_cpu_usage Generated gauge metric: cpu_usage
# TYPE synthetic_prom_cpu_usage gauge
synthetic_prom_cpu_usage{region="us-east-1",instance="i-01"} 0.45
```

**OTEL**: Exported as Gauge

### Histogram Example

```yaml
- name: request_duration_seconds
  type: histogram
  buckets: [0.01, 0.05, 0.1, 0.5, 1.0]
```

**Prometheus**:
```
# HELP synthetic_prom_request_duration_seconds Generated histogram metric: request_duration_seconds
# TYPE synthetic_prom_request_duration_seconds histogram
synthetic_prom_request_duration_seconds_bucket{region="us-east-1",instance="i-01",le="0.01"} 10
synthetic_prom_request_duration_seconds_bucket{region="us-east-1",instance="i-01",le="0.05"} 45
synthetic_prom_request_duration_seconds_bucket{region="us-east-1",instance="i-01",le="0.1"} 89
synthetic_prom_request_duration_seconds_bucket{region="us-east-1",instance="i-01",le="0.5"} 145
synthetic_prom_request_duration_seconds_bucket{region="us-east-1",instance="i-01",le="1.0"} 178
synthetic_prom_request_duration_seconds_bucket{region="us-east-1",instance="i-01",le="+Inf"} 200
synthetic_prom_request_duration_seconds_sum{region="us-east-1",instance="i-01"} 23.45
synthetic_prom_request_duration_seconds_count{region="us-east-1",instance="i-01"} 200
```

**OTEL**: Exported as Histogram with same structure

**Note**: Some backends (like SigNoz) may add suffixes like `.bucket`, `.sum`, `.count` when storing OTEL histograms.

### Summary Example

```yaml
- name: payload_size_bytes
  type: summary
  objectives:
    0.5: 0.01
    0.9: 0.01
    0.99: 0.001
```

**Prometheus**:
```
# HELP synthetic_prom_payload_size_bytes Generated summary metric: payload_size_bytes
# TYPE synthetic_prom_payload_size_bytes summary
synthetic_prom_payload_size_bytes{region="us-east-1",instance="i-01",quantile="0.5"} 1024
synthetic_prom_payload_size_bytes{region="us-east-1",instance="i-01",quantile="0.9"} 5120
synthetic_prom_payload_size_bytes{region="us-east-1",instance="i-01",quantile="0.99"} 10240
synthetic_prom_payload_size_bytes_sum{region="us-east-1",instance="i-01"} 234567
synthetic_prom_payload_size_bytes_count{region="us-east-1",instance="i-01"} 200
```

**OTEL**: Converted to Histogram (OTEL has no native Summary type)

## Generator Self-Monitoring Metrics

Built-in metrics for monitoring the generator itself.

### gen_points_total

**Type**: Counter  
**Description**: Total number of metric points generated per metric.

**Labels**:
- `metric`: Name of the user-defined metric

**Example**:
```
synthetic_prom_gen_points_total{metric="requests_total"} 3600
synthetic_prom_gen_points_total{metric="cpu_usage"} 3600
```

**Queries**:
```promql
# Points generated per second
rate(synthetic_prom_gen_points_total[1m])

# Total points across all metrics
sum(rate(synthetic_prom_gen_points_total[1m]))
```

### gen_export_errors_total

**Type**: Counter  
**Description**: Total number of export errors per exporter and metric.

**Labels**:
- `exporter`: prometheus or otel
- `metric`: Name of the metric that failed to export

**Example**:
```
synthetic_prom_gen_export_errors_total{exporter="otel",metric="requests_total"} 5
```

**Queries**:
```promql
# Export error rate
rate(synthetic_prom_gen_export_errors_total[5m])

# Errors by exporter
sum by (exporter) (rate(synthetic_prom_gen_export_errors_total[5m]))
```

**Alert**:
```yaml
- alert: MetricExportErrors
  expr: rate(synthetic_prom_gen_export_errors_total[5m]) > 0
  annotations:
    summary: "Metric export errors detected"
```

### gen_tick_duration_seconds

**Type**: Histogram  
**Description**: Time taken to complete each generation tick.

**Buckets**: [0.001, 0.005, 0.01, 0.05, 0.1, 0.5, 1.0, 5.0]

**Example**:
```
synthetic_prom_gen_tick_duration_seconds_bucket{le="0.01"} 3500
synthetic_prom_gen_tick_duration_seconds_bucket{le="0.05"} 3580
synthetic_prom_gen_tick_duration_seconds_bucket{le="0.1"} 3600
synthetic_prom_gen_tick_duration_seconds_sum 45.67
synthetic_prom_gen_tick_duration_seconds_count 3600
```

**Queries**:
```promql
# Average tick duration
rate(synthetic_prom_gen_tick_duration_seconds_sum[1m]) / 
rate(synthetic_prom_gen_tick_duration_seconds_count[1m])

# 95th percentile tick duration
histogram_quantile(0.95, 
  rate(synthetic_prom_gen_tick_duration_seconds_bucket[1m])
)

# Max tick duration
synthetic_prom_gen_tick_duration_seconds_bucket{le="+Inf"}
```

**Performance Indicators**:
- **< tick_interval**: Generator keeping up ✅
- **> tick_interval**: Generator falling behind ⚠️
- **> 2x tick_interval**: Serious performance issue ❌

### gen_active_series

**Type**: Gauge  
**Description**: Current number of active time series per metric.

**Labels**:
- `metric`: Name of the user-defined metric

**Example**:
```
synthetic_prom_gen_active_series{metric="requests_total"} 18
synthetic_prom_gen_active_series{metric="cpu_usage"} 6
```

**Queries**:
```promql
# Total active series
sum(synthetic_prom_gen_active_series)

# Series per metric
synthetic_prom_gen_active_series

# Series by metric type
sum by (metric) (synthetic_prom_gen_active_series)
```

**Cardinality Check**:
```promql
# Compare expected vs actual
sum(synthetic_prom_gen_active_series) < 1000
```

### gen_export_queue_depth

**Type**: Gauge  
**Description**: Current depth of export queue per exporter.

**Labels**:
- `exporter`: prometheus or otel

**Example**:
```
synthetic_prom_gen_export_queue_depth{exporter="otel"} 42
```

**Queries**:
```promql
# Queue depth by exporter
synthetic_prom_gen_export_queue_depth

# Growing queue (backlog)
deriv(synthetic_prom_gen_export_queue_depth[5m]) > 0
```

**Alert**:
```yaml
- alert: ExportQueueBacklog
  expr: synthetic_prom_gen_export_queue_depth > 1000
  annotations:
    summary: "Export queue backing up"
```

## Metric Labels

### Profile Labels

Labels defined in your profile are added to all metrics using that profile:

```yaml
profiles:
  app:
    labels:
      region:
        values: ["us-east-1", "eu-west-1"]
      instance:
        range: [1, 3]
        fmt: "i-%02d"
```

**Result**: Every metric using profile `app` gets `region` and `instance` labels.

### Metric-Specific Labels

Additional labels defined per metric:

```yaml
metrics:
  - name: requests_total
    profile: app
    labels:
      endpoint:
        values: ["/", "/api"]
      status:
        values: ["200", "500"]
```

**Result**: This metric gets profile labels + `endpoint` + `status`.

### Automatic Labels

Some labels are added automatically:

**Prometheus**:
- `job`: From Prometheus scrape config
- `instance`: From Prometheus scrape config

**OTEL**:
- Resource attributes (e.g., `service.name`, `deployment.environment`)

## Querying Examples

### User-Defined Metrics

```promql
# Request rate
rate(synthetic_prom_requests_total[1m])

# Request rate by endpoint
sum by (endpoint) (rate(synthetic_prom_requests_total[1m]))

# CPU usage by region
avg by (region) (synthetic_prom_cpu_usage)

# 95th percentile latency
histogram_quantile(0.95, 
  rate(synthetic_prom_request_duration_seconds_bucket[1m])
)

# Payload size p99
synthetic_prom_payload_size_bytes{quantile="0.99"}
```

### Generator Health

```promql
# Is generator running?
up{job="synthetic-metrics-generator"}

# Generation rate
rate(synthetic_prom_gen_points_total[1m])

# Generator performance
histogram_quantile(0.95, 
  rate(synthetic_prom_gen_tick_duration_seconds_bucket[1m])
)

# Export errors
rate(synthetic_prom_gen_export_errors_total[5m]) > 0

# Total series count
sum(synthetic_prom_gen_active_series)
```

### Cardinality Analysis

```promql
# Total unique series
count({__name__=~"synthetic_prom_.*"})

# Series per metric name
count by (__name__) ({__name__=~"synthetic_prom_.*"})

# Label cardinality
count by (region) ({__name__=~"synthetic_prom_.*"})
```

## Grafana Dashboard Queries

### Request Rate Panel

```promql
sum(rate(synthetic_prom_requests_total[1m])) by (endpoint)
```

### CPU Usage Panel

```promql
synthetic_prom_cpu_usage
```

### Latency Heatmap

```promql
sum(rate(synthetic_prom_request_duration_seconds_bucket[1m])) by (le)
```

### Generator Performance

```promql
# Tick duration
rate(synthetic_prom_gen_tick_duration_seconds_sum[1m]) / 
rate(synthetic_prom_gen_tick_duration_seconds_count[1m])

# Active series
sum(synthetic_prom_gen_active_series)

# Export errors
sum(rate(synthetic_prom_gen_export_errors_total[5m]))
```

## Alerting Rules

### Generator Health Alerts

```yaml
groups:
  - name: generator_health
    rules:
      - alert: GeneratorDown
        expr: up{job="synthetic-metrics-generator"} == 0
        for: 1m
        annotations:
          summary: "Generator is down"
      
      - alert: GeneratorSlowTicks
        expr: |
          histogram_quantile(0.95,
            rate(synthetic_prom_gen_tick_duration_seconds_bucket[5m])
          ) > 1
        for: 5m
        annotations:
          summary: "Generator ticks taking too long"
      
      - alert: ExportErrors
        expr: rate(synthetic_prom_gen_export_errors_total[5m]) > 0
        for: 5m
        annotations:
          summary: "Metric export errors detected"
      
      - alert: ExportQueueBacklog
        expr: synthetic_prom_gen_export_queue_depth > 1000
        for: 5m
        annotations:
          summary: "Export queue backing up"
```

## Next Steps

- **[Deployment](07-deployment.md)** - Deployment options
- **[Configuration](03-configuration.md)** - Back to configuration
- **[Control API](05-control-api.md)** - Runtime controls

